<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NamuPaiai_Wasserstandsanzeige_MQTT: GDBSTUB</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NamuPaiai_Wasserstandsanzeige_MQTT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">GDBSTUB </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Intro </h2>
<p>While the ESP8266 supports the standard Gnu set of C programming utilities, for now the choice of debuggers has been limited: there is an attempt at <a href="https://github.com/projectgus/openocd">OpenOCD support</a>, but at the time of writing, it doesn't support hardware watchpoints and breakpoints yet, and it needs a separate JTAG adapter connecting to the ESP8266s JTAG pins. As an alternative, <a href="https://www.cesanta.com/">Cesanta</a> has implemented a barebones<a href="https://blog.cesanta.com/esp8266-gdb">GDB stub</a> in their Smart.js solution - unfortunately, this only supports exception catching and needs some work before you can use it outside of the Smart.js platform. Moreover, it also does not work with FreeRTOS.</p>
<p>For internal use, we at Espressif desired a GDB stub that works with FreeRTOS and is a bit more capable, so we designed our own implementation of it. This stub works both under FreeRTOS as well as the OS-less SDK and is able to catch exceptions and do backtraces on them, read and write memory, forward [os_]printf statements to gdb, single-step instructions and set hardware break- and watchpoints. It connects to the host machine (which runs gdb) using the standard serial connection that's also used for programming.</p>
<p>In order to be useful the gdbstub has to be used in conjunction with an xtensa-lx106-elf-gdb, for example as generated by the <a href="https://github.com/pfalcon/esp-open-sdk">esp-open-sdk</a> project.</p>
<h2>Usage </h2>
<ul>
<li>Grab the gdbstub project and put the files in a directory called 'gdbstub' in your project. You can do this either by checking out the Git repo, or adding the Git repo as a submodule to your project if it's already in Git.</li>
<li>Modify your Makefile. You'll need to include the gdbstub sources: if your Makefile is structured like the ones in the Espressif examples, you can add <code>gdbstub</code> to the <code>SUBDIRS</code> define and <code>gdbstub/libgdbstub.a</code> to the <code>COMPONENTS_eagle.app.v6</code> define. Also, you probably want to add <code>-ggdb</code> to your compiler flags (<code>TARGET_LDFLAGS</code>) and, if you are debugging, change any optimation flags (-Os, -O2 etc) into <code>-Og</code>. Finally, make sure your Makefile also compiles .S files.</li>
<li>Configure gdbstub by editting <code><a class="el" href="gdbstub-cfg_8h.html">gdbstub-cfg.h</a></code>. There are a bunch of options you can tweak: FreeRTOS or bare SDK, private exception/breakpoint stack, console redirection to GDB, wait till debugger attachment etc. You can also configure the options by including the proper -Dwhatever gcc flags in your Makefiles.</li>
<li>In your user_main.c, add an <code>#include &lt;../gdbstub/gdbstub.h&gt;</code> and call <code><a class="el" href="_g_d_b_stub_8h.html#ad0996bb30073a2e50158f1663458628b">gdbstub_init()</a>;</code> somewhere in user_main.</li>
<li>Compile and flash your board.</li>
<li>Run gdb, depending on your configuration immediately after resetting the board or after it has run into an exception. The easiest way to do it is to use the provided script: xtensa-lx106-elf-gdb -x gdbcmds -b 38400 Change the '38400' into the baud rate your code uses. You may need to change the gdbcmds script to fit the configuration of your hardware and build environment.</li>
</ul>
<h2>Notes </h2>
<ul>
<li>Using software breakpoints ('br') only works on code that's in RAM. Code in flash can only have a hardware breakpoint ('hbr').</li>
<li>Due to hardware limitations, only one hardware breakpount and one hardware watchpoint are available.</li>
<li>Pressing control-C to interrupt the running program depends on gdbstub hooking the UART interrupt. If some code re-hooks this afterwards, gdbstub won't be able to receive characters. If gdbstub handles the interrupt, the user code will not receive any characters.</li>
<li>Continuing from an exception is not (yet) supported in FreeRTOS mode.</li>
<li>The WiFi hardware is designed to be serviced by software periodically. It has some buffers so it will behave OK when some data comes in while the processor is busy, but these buffers are not infinite. If the WiFi hardware receives lots of data while the debugger has stopped the <a class="el" href="class_c_p_u.html">CPU</a>, it is bound to crash. This will happen mostly when working with <a class="el" href="class_u_d_p.html">UDP</a> and/or ICMP; TCP-connections in general will not send much more data when the other side doesn't send any ACKs.</li>
</ul>
<h2>License </h2>
<p>This gdbstub is licensed under the Espressif MIT license, as described in the License file.</p>
<h2>Thanks </h2>
<ul>
<li>Cesanta, for their initial ESP8266 exception handling only gdbstub,</li>
<li>jcmvbkbc, for providing an incompatible but interesting gdbstub for other Xtensa CPUs,</li>
<li>Sysprogs (makers of VisualGDB), for their suggestions and bugreports. </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
