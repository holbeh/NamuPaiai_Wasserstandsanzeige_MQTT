<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NamuPaiai_Wasserstandsanzeige_MQTT: ESP8266 WiFi Mesh</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NamuPaiai_Wasserstandsanzeige_MQTT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ESP8266 WiFi Mesh </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A library for turning your ESP8266 into a mesh network node.</p>
<p>The library has been tested and works with Arduino core for ESP8266 version 2.3.0 (with default lwIP) and 2.4.2 or higher (with lwIP 1.4 and lwIP2).</p>
<p><b>Note:</b> This mesh library has been rewritten for core release 2.4.2. The old method signatures have been retained for compatibility purposes, but will be removed in core release 2.5.0. If you are still using these old method signatures please consider migrating to the new API shown in the <code><a class="el" href="_e_s_p8266_wi_fi_mesh_8h.html">ESP8266WiFiMesh.h</a></code> source file.</p>
<h2>Usage </h2>
<p>The basic operation of a mesh node is as follows:</p>
<p>The <code>attemptTransmission</code> method of the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instance is called with a message to send to other nodes in the mesh network. If the node is already connected to an AP, the message is sent only to that AP. Otherwise a WiFi scan is performed. The scan results are sent to the <code>networkFilter</code> callback function of the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instance which adds the AP:s of interest to the <code>connectionQueue</code> vector. The message is then transmitted to the networks in the <code>connectionQueue</code>, and the response from each AP is sent to the <code>responseHandler</code> callback of the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instance. The outcome from each transmission attempt can be found in the <code>latestTransmissionOutcomes</code> vector.</p>
<p>The node receives messages from other nodes by calling the <code>acceptRequest</code> method of the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instance. These received messages are passed to the <code>requestHandler</code> callback of the mesh instance. For each received message the return value of <code>requestHandler</code> is sent to the other node as a response to the message.</p>
<p>For more details, see the included example. The main functions to modify in the example are <code>manageRequest</code> (<code>requestHandler</code>), <code>manageResponse</code> (<code>responseHandler</code>) and <code>networkFilter</code>. There is also more information to be found in the source code comments. An example is the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> constructor comment, which is shown below for reference: </p><div class="fragment"><div class="line">/**</div><div class="line">* WiFiMesh Constructor method. Creates a WiFi Mesh Node, ready to be initialised.</div><div class="line">*</div><div class="line">* @param requestHandler The callback handler for dealing with received requests. Takes a string as an argument which</div><div class="line">*          is the request string received from another node and returns the string to send back.</div><div class="line">* @param responseHandler The callback handler for dealing with received responses. Takes a string as an argument which</div><div class="line">*          is the response string received from another node. Returns a transmission status code as a transmission_status_t.</div><div class="line">* @param networkFilter The callback handler for deciding which WiFi networks to connect to.</div><div class="line">* @param meshPassword The WiFi password for the mesh network.</div><div class="line">* @param meshName The name of the mesh network. Used as prefix for the node SSID and to find other network nodes in the example network filter function.</div><div class="line">* @param nodeID The id for this mesh node. Used as suffix for the node SSID. If set to &quot;&quot;, the id will default to ESP.getChipId().</div><div class="line">* @param verboseMode Determines if we should print the events occurring in the library to Serial. Off by default.</div><div class="line">* @param meshWiFiChannel The WiFi channel used by the mesh network. Valid values are integers from 1 to 13. Defaults to 1.</div><div class="line">*                    WARNING: The ESP8266 has only one WiFi channel, and the the station/client mode is always prioritized for channel selection.</div><div class="line">*                    This can cause problems if several ESP8266WiFiMesh instances exist on the same ESP8266 and use different WiFi channels. </div><div class="line">*                    In such a case, whenever the station of one ESP8266WiFiMesh instance connects to an AP, it will silently force the </div><div class="line">*                    WiFi channel of any active AP on the ESP8266 to match that of the station. This will cause disconnects and possibly </div><div class="line">*                    make it impossible for other stations to detect the APs whose WiFi channels have changed.</div><div class="line">* @param serverPort The server port used by the AP of the ESP8266WiFiMesh instance. If multiple APs exist on a single ESP8266, each requires a separate server port. </div><div class="line">*                    If two AP:s on the same ESP8266 are using the same server port, they will not be able to have both server instances active at the same time.                  </div><div class="line">*                    This is managed automatically by the activateAP method.</div><div class="line">* </div><div class="line">*/</div><div class="line">ESP8266WiFiMesh(requestHandlerType requestHandler, responseHandlerType responseHandler, networkFilterType networkFilter, </div><div class="line">                const String &amp;meshPassword, const String &amp;meshName = &quot;MeshNode_&quot;, const String &amp;nodeID = WIFI_MESH_EMPTY_STRING, bool verboseMode = false, </div><div class="line">                uint8 meshWiFiChannel = 1, int serverPort = 4011);</div></div><!-- fragment --><h3>Note</h3>
<ul>
<li><p class="startli">This library can use static IP:s for the nodes to speed up connection times. To enable this, use the <code>setStaticIP</code> method after calling the <code>begin</code> method, as in the included example. Ensure that nodes connecting to the same AP have distinct static IP:s. Node IP:s need to be at the same subnet as the server gateway (192.168.4 for this library by default). It may also be worth noting that station gateway IP must match the IP for the server on the nodes, though this is the default setting for the library.</p>
<p class="startli">At the moment static IP is a global setting, meaning that all <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instances on the same ESP8266 share the same static IP settings.</p>
</li>
<li><p class="startli">When Arduino core for ESP8266 version 2.4.2 or higher is used, there are optimizations available for WiFi scans and static IP use to reduce the time it takes for nodes to connect to each other. These optimizations are enabled by default. To take advantage of the static IP optimizations you also need to use lwIP2. The lwIP version can be changed in the Tools menu of Arduino IDE.</p>
<p class="startli">If you are using a core version prior to 2.4.2 it is possible to disable the WiFi scan and static IP optimizations by commenting out the <code>ENABLE_STATIC_IP_OPTIMIZATION</code> and <code>ENABLE_WIFI_SCAN_OPTIMIZATION</code> defines in <a class="el" href="_e_s_p8266_wi_fi_mesh_8h.html">ESP8266WiFiMesh.h</a>. Press Ctrl+K in the Arduino IDE while an example from the mesh library is opened, to open the library folder (or click "Show Sketch Folder" in the Sketch menu). <a class="el" href="_e_s_p8266_wi_fi_mesh_8h.html">ESP8266WiFiMesh.h</a> can then be found at ESP8266WiFiMesh/src. Edit the file with any text editor.</p>
</li>
<li>The WiFi scan optimization mentioned above works by making WiFi scans only search through the same WiFi channel as the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instance is using. If you would like to scan all WiFi channels instead, set the <code>scanAllWiFiChannels</code> argument of the <code>attemptTransmission</code> method to <code>true</code>. Note that scanning all WiFi channels will slow down scans considerably and make it more likely that existing WiFi connections will break during scans. Also note that if the ESP8266 has an active AP, that AP will switch WiFi channel to match that of any other AP the ESP8266 connects to (compare next bullet point). This can make it impossible for other nodes to detect the AP if they are scanning the wrong WiFi channel. To remedy this, force the AP back on the original channel by using the <code>restartAP</code> method of the current AP controller once the ESP8266 has disconnected from the other AP. This would typically be done like so:</li>
</ul>
<div class="fragment"><div class="line">if(ESP8266WiFiMesh *apController = ESP8266WiFiMesh::getAPController()) // Make sure apController is not nullptr</div><div class="line">  apController-&gt;restartAP();</div></div><!-- fragment --><ul>
<li>It is possible to have several <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instances running on every ESP8266 (e.g. to communicate with different mesh networks). However, because the ESP8266 has one WiFi radio only one AP per ESP8266 can be active at a time. Also note that if the <a class="el" href="class_e_s_p8266_wi_fi_mesh.html">ESP8266WiFiMesh</a> instances use different WiFi channels, active APs are forced to use the same WiFi channel as active stations, possibly causing AP disconnections.</li>
<li>While it is possible to connect to other nodes by only giving their SSID, e.g. <code>ESP8266WiFiMesh::connectionQueue.push_back(<a class="el" href="class_network_info.html">NetworkInfo</a>("NodeSSID"));</code>, it is recommended that AP WiFi channel and AP BSSID are given as well, to minimize connection delay.</li>
<li>Also, remember to change the default mesh network WiFi password!</li>
</ul>
<h2>General Information </h2>
<ul>
<li>This library uses the standard Arduino core for ESP8266 WiFi functions. Therefore, other code that also uses these WiFi functions may cause conflicts with the library, resulting in strange behaviour.</li>
<li>By default, a maximum of 4 stations can be connected at a time to each AP. This can be changed to a value in the range 0 to 8 via the <code>setMaxAPStations</code> method. Once the max number has been reached, any other station that wants to connect will be forced to wait until an already connected station disconnects. The more stations that are connected, the more memory is required.</li>
<li>Unlike <code>WiFi.mode(WIFI_AP)</code>, the <code>WiFi.mode(WIFI_AP_STA)</code> which is used in this library allows nodes to stay connected to an AP they connect to while in STA mode, at the same time as they can receive connections from other stations. Nodes cannot send data to an AP while in STA_AP mode though, that requires STA mode. Switching to STA mode will sometimes disconnect stations connected to the node AP (though they can request a reconnect even while the previous AP node is in STA mode).</li>
<li>Scanning for networks (e.g. via the <code>attemptTransmission</code> method) without the WiFi scan optimizations for core version 2.4.2 mentioned above, causes the WiFi radio to cycle through all WiFi channels which means existing WiFi connections are likely to break or work poorly if done frequently. </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
