<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NamuPaiai_Wasserstandsanzeige_MQTT: SPIFFS (SPI Flash File System)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NamuPaiai_Wasserstandsanzeige_MQTT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SPIFFS (SPI Flash File System) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>V0.3.7</b></p>
<p><a href="https://travis-ci.org/pellepl/spiffs"><img src="https://travis-ci.org/pellepl/spiffs.svg?branch=master" alt="Build Status" class="inline"/>
</a></p>
<p>Copyright (c) 2013-2017 Peter Andersson (pelleplutt1976 at gmail.com)</p>
<p>For legal stuff, see <a href="https://github.com/pellepl/spiffs/blob/master/LICENSE">LICENSE</a>. Basically, you may do whatever you want with the source. Use, modify, sell, print it out, roll it and smoke it - as long as I won't be held responsible.</p>
<p>Love to hear feedback though!</p>
<h2>INTRODUCTION</h2>
<p>Spiffs is a file system intended for SPI NOR flash devices on embedded targets.</p>
<p>Spiffs is designed with following characteristics in mind:</p><ul>
<li>Small (embedded) targets, sparse RAM without heap</li>
<li>Only big areas of data (blocks) can be erased</li>
<li>An erase will reset all bits in block to ones</li>
<li>Writing pulls one to zeroes</li>
<li>Zeroes can only be pulled to ones by erase</li>
<li>Wear leveling</li>
</ul>
<h2>BUILDING</h2>
<p><code>mkdir build; make</code></p>
<p>Otherwise, configure the <code>builddir</code> variable towards the top of <code>makefile</code> as something opposed to the default <code>build</code>. Sanity check on the host via <code>make test</code> and refer to <code>.travis.yml</code> for the official in-depth testing procedure. See the wiki for <a href="https://github.com/pellepl/spiffs/wiki/Integrate-spiffs">integrating</a> spiffs into projects and <a href="https://github.com/nodemcu/nodemcu-firmware/tree/master/tools/spiffsimg">spiffsimg</a> from <a href="https://github.com/nodemcu">nodemcu</a> is a good example on the subject.</p>
<h2>FEATURES</h2>
<p>What spiffs does:</p><ul>
<li>Specifically designed for low ram usage</li>
<li>Uses statically sized ram buffers, independent of number of files</li>
<li>Posix-like api: open, close, read, write, seek, stat, etc</li>
<li>It can run on any NOR flash, not only SPI flash - theoretically also on embedded flash of a microprocessor</li>
<li>Multiple spiffs configurations can run on same target - and even on same SPI flash device</li>
<li>Implements static wear leveling</li>
<li>Built in file system consistency checks</li>
<li>Highly configurable</li>
</ul>
<p>What spiffs does not:</p><ul>
<li>Presently, spiffs does not support directories. It produces a flat structure. Creating a file with path <em>tmp/myfile.txt</em> will create a file called <em>tmp/myfile.txt</em> instead of a <em>myfile.txt</em> under directory <em>tmp</em>.</li>
<li>It is not a realtime stack. One write operation might last much longer than another.</li>
<li>Poor scalability. Spiffs is intended for small memory devices - the normal sizes for SPI flashes. Going beyond ~128Mbyte is probably a bad idea. This is a side effect of the design goal to use as little ram as possible.</li>
<li>Presently, it does not detect or handle bad blocks.</li>
<li>One configuration, one binary. There's no generic spiffs binary that handles all types of configurations.</li>
</ul>
<h2>MORE INFO</h2>
<p>See the <a href="https://github.com/pellepl/spiffs/wiki">wiki</a> for <a href="https://github.com/pellepl/spiffs/wiki/Configure-spiffs">configuring</a>, <a href="https://github.com/pellepl/spiffs/wiki/Integrate-spiffs">integrating</a>, <a href="https://github.com/pellepl/spiffs/wiki/Using-spiffs">using</a>, and <a href="https://github.com/pellepl/spiffs/wiki/Performance-and-Optimizing">optimizing</a> spiffs.</p>
<p>For design, see <a href="https://github.com/pellepl/spiffs/blob/master/docs/TECH_SPEC">docs/TECH_SPEC</a>.</p>
<p>For a generic spi flash driver, see <a href="https://github.com/pellepl/spiflash_driver">this</a>.</p>
<h2>HISTORY</h2>
<h3>0.3.7</h3>
<ul>
<li>fixed prevent seeking to negative offsets #158</li>
<li>fixed file descriptor offsets not updated for multiple fds on same file #157</li>
<li>fixed cache page not closed for removed files #156</li>
<li>fixed a lseek bug when seeking exactly to end of a fully indexed first level LUT #148</li>
<li>fixed wear leveling issue #145</li>
<li>fixed attempt to write out of bounds in flash #130,</li>
<li>set file offset when seeking over end #121 (thanks @sensslen)</li>
<li>fixed seeking in virgin files #120 (thanks @sensslen)</li>
<li>Optional file metadata #128 (thanks @cesanta)</li>
<li>AFL testing framework #100 #143 (thanks @pjsg)</li>
<li>Testframe updates</li>
</ul>
<p>New API functions:</p><ul>
<li><code>SPIFFS_update_meta, SPIFFS_fupdate_meta</code> - updates metadata for a file</li>
</ul>
<p>New config defines:</p><ul>
<li><code>SPIFFS_OBJ_META_LEN</code> - enable possibility to add extra metadata to files</li>
</ul>
<h3>0.3.6</h3>
<ul>
<li>Fix range bug in index memory mapping #98</li>
<li>Add index memory mapping #97</li>
<li>Optimize SPIFFS_read for large files #96</li>
<li>Add temporal cache for opening files #95</li>
<li>More robust gc #93 (thanks @dismirlian)</li>
<li>Fixed a double write of same data in certain cache situations</li>
<li>Fixed an open bug in READ_ONLY builds</li>
<li>File not visible in SPIFFS_readdir #90 (thanks @benpicco-tmp)</li>
<li>Cache load code cleanup #92 (thanks @niclash)</li>
<li>Fixed lock/unlock asymmetry #88 #87 (thanks @JackJefferson, @dpruessner)</li>
<li>Testframe updates</li>
</ul>
<p>New API functions:</p><ul>
<li><code>SPIFFS_ix_map</code> - map index meta data to memory for a file</li>
<li><code>SPIFFS_ix_unmap</code> - unmaps index meta data for a file</li>
<li><code>SPIFFS_ix_remap</code> - changes file offset for index metadata map</li>
<li><code>SPIFFS_bytes_to_ix_map_entries</code> - utility, get length of needed vector for given amount of bytes</li>
<li><code>SPIFFS_ix_map_entries_to_bytes</code> - utility, get number of bytes a vector can represent given length</li>
</ul>
<p>New config defines:</p><ul>
<li><code>SPIFFS_IX_MAP</code> - enable possibility to map index meta data to memory for reading faster</li>
<li><code>SPIFFS_TEMPORAL_FD_CACHE</code> - enable temporal cache for opening files faster</li>
<li><code>SPIFFS_TEMPORAL_CACHE_HIT_SCORE</code> - for tuning the temporal cache</li>
</ul>
<h3>0.3.5</h3>
<ul>
<li>Fixed a bug in fs check</li>
<li>API returns actual error codes #84) (thanks @Nails)</li>
<li>Fix compiler warnings for non-gcc #83 #81 (thanks @Nails)</li>
<li>Unable to recover from full fs #82 (thanks @rojer)</li>
<li>Define SPIFFS_O_* flags #80</li>
<li>Problem with long filenames #79 (thanks @psjg)</li>
<li>Duplicate file name bug fix #74 (thanks @igrr)</li>
<li>SPIFFS_eof and SPIFFS_tell return wrong value #72 (thanks @ArtemPisarenko)</li>
<li>Bunch of testframe updates #77 #78 #86 (thanks @dpreussner, @psjg a.o)</li>
</ul>
<h3>0.3.4</h3>
<ul>
<li>Added user callback file func.</li>
<li>Fixed a stat bug with obj id.</li>
<li>SPIFFS_probe_fs added</li>
<li>Add possibility to compile a read-only version of spiffs</li>
<li>Make magic dependent on fs length, if needed (see #59 &amp; #66) (thanks @hreintke)</li>
<li>Exposed SPIFFS_open_by_page_function</li>
<li>Zero-size file cannot be seek #57 (thanks @lishen2)</li>
<li>Add tell and eof functions #54 (thanks @raburton)</li>
<li>Make api string params const #53 (thanks @raburton)</li>
<li>Preserve user_data during <a class="el" href="namespacefs.html#aac20108b49cfea9dcff434e8e6ca708a">mount()</a> #51 (thanks @rojer)</li>
</ul>
<p>New API functions:</p><ul>
<li><code>SPIFFS_set_file_callback_func</code> - register a callback informing about file events</li>
<li><code>SPIFFS_probe_fs</code> - probe a spi flash trying to figure out size of fs</li>
<li><code>SPIFFS_open_by_page</code> - open a file by page index</li>
<li><code>SPIFFS_eof</code> - checks if end of file is reached</li>
<li><code>SPIFFS_tell</code> - returns current file offset</li>
</ul>
<p>New config defines:</p><ul>
<li><code>SPIFFS_READ_ONLY</code></li>
<li><code>SPIFFS_USE_MAGIC_LENGTH</code></li>
</ul>
<h3>0.3.3</h3>
<p><b>Might not be compatible with 0.3.2 structures. See issue #40</b></p><ul>
<li>Possibility to add integer offset to file handles</li>
<li>Truncate function presumes too few free pages #49</li>
<li>Bug in truncate function #48 (thanks @PawelDefee)</li>
<li>Update spiffs_gc.c - remove unnecessary parameter (thanks @PawelDefee)</li>
<li>Update INTEGRATION docs (thanks @PawelDefee)</li>
<li>Fix pointer truncation in 64-bit platforms (thanks @igrr)</li>
<li>Zero-sized files cannot be read #44 (thanks @rojer)</li>
<li>(More) correct calculation of max_id in obj_lu_find #42 #41 (thanks @lishen2)</li>
<li>Check correct error code in obj_lu_find_free #41 (thanks @lishen2)</li>
<li>Moar comments for SPIFFS_lseek (thanks @igrr)</li>
<li>Fixed padding in spiffs_page_object_ix #40 (thanks @jmattsson @lishen2)</li>
<li>Fixed gc_quick test (thanks @jmattsson)</li>
<li>Add SPIFFS_EXCL flag #36</li>
<li>SPIFFS_close may fail silently if cache is enabled #37</li>
<li>User data in callbacks #34</li>
<li>Ignoring SINGLETON build in cache setup (thanks Luca)</li>
<li>Compilation error fixed #32 (thanks @chotasanjiv)</li>
<li>Align cand_scores (thanks @hefloryd)</li>
<li>Fix build warnings when SPIFFS_CACHE is 0 (thanks @ajaybhargav)</li>
</ul>
<p>New config defines:</p><ul>
<li><code>SPIFFS_FILEHDL_OFFSET</code></li>
</ul>
<h3>0.3.2</h3>
<ul>
<li>Limit cache size if too much cache is given (thanks pgeiem)</li>
<li>New feature - Controlled erase. #23</li>
<li>SPIFFS_rename leaks file descriptors #28 (thanks benpicco)</li>
<li>moved dbg print defines in test framework to params_test.h</li>
<li>lseek should return the resulting offset (thanks hefloryd)</li>
<li>fixed type on dbg ifdefs</li>
<li>silence warning about signed/unsigned comparison when spiffs_obj_id is 32 bit (thanks benpicco)</li>
<li>Possible error in test_spiffs.c #21 (thanks yihcdaso-yeskela)</li>
<li>Cache might writethrough too often #16</li>
<li>even moar testrunner updates</li>
<li>Test framework update and some added tests</li>
<li>Some thoughts for next gen</li>
<li>Test sigsevs when having too many sectors #13 (thanks alonewolfx2)</li>
<li>GC might be suboptimal #11</li>
<li>Fix eternal readdir when objheader at last block, last entry</li>
</ul>
<p>New API functions:</p><ul>
<li><code>SPIFFS_gc_quick</code> - call a nonintrusive gc</li>
<li><code>SPIFFS_gc</code> - call a full-scale intrusive gc</li>
</ul>
<h3>0.3.1</h3>
<ul>
<li>Removed two return warnings, was too triggerhappy on release</li>
</ul>
<h3>0.3.0</h3>
<ul>
<li>Added existing namecheck when creating files</li>
<li>Lots of static analysis bugs #6</li>
<li>Added rename func</li>
<li>Fix SPIFFS_read length when reading beyond file size</li>
<li>Added reading beyond file length testcase</li>
<li>Made build a bit more configurable</li>
<li>Changed name in spiffs from "errno" to "err_code" due to conflicts compiling in mingw</li>
<li>Improved GC checks, fixed an append bug, more robust truncate for very special case</li>
<li>GC checks preempts GC, truncate even less picky</li>
<li>Struct alignment needed for some targets, define in spiffs config #10</li>
<li>Spiffs filesystem magic, definable in config</li>
</ul>
<p>New config defines:</p><ul>
<li><code>SPIFFS_USE_MAGIC</code> - enable or disable magic check upon mount</li>
<li><code>SPIFFS_ALIGNED_OBJECT_INDEX_TABLES</code> - alignment for certain targets</li>
</ul>
<p>New API functions:</p><ul>
<li><code>SPIFFS_rename</code> - rename files</li>
<li><code>SPIFFS_clearerr</code> - clears last errno</li>
<li><code>SPIFFS_info</code> - returns info on used and total bytes in fs</li>
<li><code>SPIFFS_format</code> - formats the filesystem</li>
<li><code>SPIFFS_mounted</code> - checks if filesystem is mounted </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
